<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Custom GPT System</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; background: #f5f5f5; }
        .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
        .header { background: white; padding: 20px; border-radius: 8px; margin-bottom: 20px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .card { background: white; padding: 20px; border-radius: 8px; margin-bottom: 20px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .btn { padding: 10px 20px; border: none; border-radius: 4px; cursor: pointer; margin: 5px; }
        .btn-primary { background: #007bff; color: white; }
        .btn-secondary { background: #6c757d; color: white; }
        .input { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px; margin: 5px 0; }
        .chat-container { height: 400px; overflow-y: auto; border: 1px solid #ddd; padding: 10px; margin: 10px 0; }
        .message { margin: 10px 0; padding: 10px; border-radius: 4px; }
        .user-message { background: #e3f2fd; margin-left: 20%; }
        .assistant-message { background: #f1f8e9; margin-right: 20%; }
        .nav { display: flex; gap: 10px; margin-bottom: 20px; }
        .nav button { padding: 10px 20px; border: none; background: #f8f9fa; cursor: pointer; border-radius: 4px; }
        .nav button.active { background: #007bff; color: white; }
        .status { padding: 5px 10px; border-radius: 20px; font-size: 12px; }
        .status-created { background: #d1ecf1; color: #0c5460; }
        .status-training { background: #fff3cd; color: #856404; }
        .status-ready { background: #d4edda; color: #155724; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        function App() {
            const [currentView, setCurrentView] = useState('dashboard');
            const [user, setUser] = useState(null);
            const [models, setModels] = useState([]);
            const [conversations, setConversations] = useState({});

            useEffect(() => {
                checkHealth();
                loadModels();
            }, []);

            const checkHealth = async () => {
                try {
                    const response = await axios.get('/api/health');
                    console.log('Health check:', response.data);
                } catch (error) {
                    console.error('Health check failed:', error);
                }
            };

            const loadModels = async () => {
                try {
                    const response = await axios.get('/api/models');
                    if (response.data.success) {
                        setModels(response.data.models);
                    }
                } catch (error) {
                    console.error('Failed to load models:', error);
                }
            };

            const login = async (email, password) => {
                try {
                    const response = await axios.post('/api/auth/login', { email, password });
                    if (response.data.success) {
                        setUser(response.data.user);
                        return true;
                    }
                } catch (error) {
                    console.error('Login failed:', error);
                }
                return false;
            };

            const createModel = async (name, description) => {
                try {
                    const response = await axios.post('/api/models', { name, description });
                    if (response.data.success) {
                        setModels([...models, response.data.model]);
                        return true;
                    }
                } catch (error) {
                    console.error('Failed to create model:', error);
                }
                return false;
            };

            const sendMessage = async (message, conversationId = 'default') => {
                try {
                    const response = await axios.post('/api/chat', { message, conversation_id: conversationId });
                    if (response.data.success) {
                        const newMessage = {
                            user: message,
                            assistant: response.data.response,
                            timestamp: new Date().toISOString()
                        };
                        setConversations(prev => ({
                            ...prev,
                            [conversationId]: [...(prev[conversationId] || []), newMessage]
                        }));
                        return response.data.response;
                    }
                } catch (error) {
                    console.error('Failed to send message:', error);
                }
                return null;
            };

            if (!user) {
                return <LoginForm onLogin={login} />;
            }

            return (
                <div className="container">
                    <div className="header">
                        <h1>Custom GPT System</h1>
                        <p>Welcome, {user.email}!</p>
                    </div>

                    <div className="nav">
                        <button 
                            className={currentView === 'dashboard' ? 'active' : ''} 
                            onClick={() => setCurrentView('dashboard')}
                        >
                            Dashboard
                        </button>
                        <button 
                            className={currentView === 'models' ? 'active' : ''} 
                            onClick={() => setCurrentView('models')}
                        >
                            Models
                        </button>
                        <button 
                            className={currentView === 'chat' ? 'active' : ''} 
                            onClick={() => setCurrentView('chat')}
                        >
                            Chat
                        </button>
                        <button 
                            className={currentView === 'training' ? 'active' : ''} 
                            onClick={() => setCurrentView('training')}
                        >
                            Training
                        </button>
                        <button 
                            className={currentView === 'subscription' ? 'active' : ''} 
                            onClick={() => setCurrentView('subscription')}
                        >
                            Subscription
                        </button>
                    </div>

                    {currentView === 'dashboard' && <Dashboard models={models} />}
                    {currentView === 'models' && <ModelsView models={models} onCreateModel={createModel} />}
                    {currentView === 'chat' && <ChatView conversations={conversations} onSendMessage={sendMessage} />}
                    {currentView === 'training' && <TrainingView models={models} />}
                    {currentView === 'subscription' && <Subscription />}
                </div>
            );
        }

        function LoginForm({ onLogin }) {
            const [email, setEmail] = useState('');
            const [password, setPassword] = useState('');

            const handleSubmit = async (e) => {
                e.preventDefault();
                const success = await onLogin(email, password);
                if (!success) {
                    alert('Login failed');
                }
            };

            return (
                <div className="container">
                    <div className="card" style={{maxWidth: '400px', margin: '100px auto'}}>
                        <h2>Login to Custom GPT</h2>
                        <form onSubmit={handleSubmit}>
                            <input
                                className="input"
                                type="email"
                                placeholder="Email"
                                value={email}
                                onChange={(e) => setEmail(e.target.value)}
                                required
                            />
                            <input
                                className="input"
                                type="password"
                                placeholder="Password"
                                value={password}
                                onChange={(e) => setPassword(e.target.value)}
                                required
                            />
                            <button className="btn btn-primary" type="submit">Login</button>
                        </form>
                        <p style={{marginTop: '10px', fontSize: '14px', color: '#666'}}>
                            Use any email and password to login (demo mode)
                        </p>
                    </div>
                </div>
            );
        }

        function Dashboard({ models }) {
            return (
                <div>
                    <div className="card">
                        <h2>Dashboard</h2>
                        <div style={{display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(200px, 1fr))', gap: '20px', marginTop: '20px'}}>
                            <div style={{background: '#e3f2fd', padding: '20px', borderRadius: '8px'}}>
                                <h3>{models.length}</h3>
                                <p>Total Models</p>
                            </div>
                            <div style={{background: '#f1f8e9', padding: '20px', borderRadius: '8px'}}>
                                <h3>{models.filter(m => m.status === 'ready').length}</h3>
                                <p>Ready Models</p>
                            </div>
                            <div style={{background: '#fff3cd', padding: '20px', borderRadius: '8px'}}>
                                <h3>{models.filter(m => m.status === 'training').length}</h3>
                                <p>Training</p>
                            </div>
                        </div>
                    </div>
                </div>
            );
        }

        function ModelsView({ models, onCreateModel }) {
            const [showCreateForm, setShowCreateForm] = useState(false);
            const [newModelName, setNewModelName] = useState('');
            const [newModelDescription, setNewModelDescription] = useState('');

            const handleCreate = async (e) => {
                e.preventDefault();
                const success = await onCreateModel(newModelName, newModelDescription);
                if (success) {
                    setShowCreateForm(false);
                    setNewModelName('');
                    setNewModelDescription('');
                }
            };

            return (
                <div>
                    <div className="card">
                        <div style={{display: 'flex', justifyContent: 'space-between', alignItems: 'center'}}>
                            <h2>Models</h2>
                            <button className="btn btn-primary" onClick={() => setShowCreateForm(true)}>
                                Create Model
                            </button>
                        </div>

                        {showCreateForm && (
                            <form onSubmit={handleCreate} style={{marginTop: '20px', padding: '20px', background: '#f8f9fa', borderRadius: '8px'}}>
                                <input
                                    className="input"
                                    placeholder="Model Name"
                                    value={newModelName}
                                    onChange={(e) => setNewModelName(e.target.value)}
                                    required
                                />
                                <textarea
                                    className="input"
                                    placeholder="Description"
                                    value={newModelDescription}
                                    onChange={(e) => setNewModelDescription(e.target.value)}
                                    rows="3"
                                />
                                <button className="btn btn-primary" type="submit">Create</button>
                                <button className="btn btn-secondary" type="button" onClick={() => setShowCreateForm(false)}>
                                    Cancel
                                </button>
                            </form>
                        )}

                        <div style={{marginTop: '20px'}}>
                            {models.length === 0 ? (
                                <p>No models yet. Create your first model!</p>
                            ) : (
                                models.map(model => (
                                    <div key={model.id} style={{padding: '15px', border: '1px solid #ddd', borderRadius: '8px', margin: '10px 0'}}>
                                        <div style={{display: 'flex', justifyContent: 'space-between', alignItems: 'center'}}>
                                            <div>
                                                <h3>{model.name}</h3>
                                                <p style={{color: '#666', margin: '5px 0'}}>{model.description}</p>
                                                <span className={`status status-${model.status}`}>{model.status}</span>
                                            </div>
                                        </div>
                                    </div>
                                ))
                            )}
                        </div>
                    </div>
                </div>
            );
        }

        function ChatView({ conversations, onSendMessage }) {
            const [message, setMessage] = useState('');
            const [currentConversation] = useState('default');

            const handleSend = async (e) => {
                e.preventDefault();
                if (message.trim()) {
                    await onSendMessage(message, currentConversation);
                    setMessage('');
                }
            };

            const messages = conversations[currentConversation] || [];

            return (
                <div className="card">
                    <h2>Chat</h2>
                    <div className="chat-container">
                        {messages.length === 0 ? (
                            <p style={{textAlign: 'center', color: '#666', marginTop: '50px'}}>
                                Start a conversation!
                            </p>
                        ) : (
                            messages.map((msg, index) => (
                                <div key={index}>
                                    <div className="message user-message">
                                        <strong>You:</strong> {msg.user}
                                    </div>
                                    <div className="message assistant-message">
                                        <strong>Assistant:</strong> {msg.assistant}
                                    </div>
                                </div>
                            ))
                        )}
                    </div>
                    <form onSubmit={handleSend}>
                        <div style={{display: 'flex', gap: '10px'}}>
                            <input
                                className="input"
                                placeholder="Type your message..."
                                value={message}
                                onChange={(e) => setMessage(e.target.value)}
                                style={{flex: 1}}
                            />
                            <button className="btn btn-primary" type="submit">Send</button>
                        </div>
                    </form>
                </div>
            );
        }

        function TrainingView({ models }) {
            return (
                <div className="card">
                    <h2>Training</h2>
                    <p>Training functionality will be implemented here.</p>
                    <div style={{marginTop: '20px'}}>
                        {models.map(model => (
                            <div key={model.id} style={{padding: '15px', border: '1px solid #ddd', borderRadius: '8px', margin: '10px 0'}}>
                                <h3>{model.name}</h3>
                                <span className={`status status-${model.status}`}>{model.status}</span>
                                {model.status === 'created' && (
                                    <button className="btn btn-primary" style={{marginLeft: '10px'}}>
                                        Start Training
                                    </button>
                                )}
                            </div>
                        ))}
                    </div>
                </div>
            );
        }
        function Subscription() {
            return (
                <div className="card">
                    <h2>Subscription</h2>
                    <p>Subscription functionality will be implemented here.</p>
                </div>
            );
        }

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
    <script src="Dashboard.jsx" type="text/babel"></script>
    <script src="Chat.jsx" type="text/babel"></script>
    <script src="Training.jsx" type="text/babel"></script>
    <script src="Models.jsx" type="text/babel"></script>
    <script src="MonitoringDashboard.jsx" type="text/babel"></script>
    <script src="Analytics.jsx" type="text/babel"></script>
    <script src="Reports.jsx" type="text/babel"></script>
    <script src="Subscription.jsx" type="text/babel"></script>
    <script src="Settings.jsx" type="text/babel"></script>
</body>
</html>